{
    "sourceFile": "src/app/public/upcoming-matches/upcoming-matches.component.ts",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1765232066594,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1765232066594,
            "name": "Commit-0",
            "content": "import { Component, inject, ChangeDetectorRef } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { ApiService } from '../../core/services/api.service';\nimport { SoccerFieldWrapperComponent } from '../../shared/components/soccer-field-wrapper/soccer-field-wrapper.component';\n\n@Component({\n    selector: 'app-upcoming-matches',\n    standalone: true,\n    imports: [CommonModule, SoccerFieldWrapperComponent],\n    template: `\n    <app-soccer-field-wrapper title=\"Próximos Partidos\">\n      <!-- Ideally we would select a tournament, but for now lets list for known tournament ID from query param or just hardcode/fetch all if API supports it. \n           The backend API 'getUpcomingMatches' requires an ID. I'll make a selector or just fetch for ID=1 for demo purposes if no ID provided, \n           or logic to fetch active tournaments first then upcoming matches for them.\n           Actually public controller endpoint was /torneos/{id}/partidos/proximos.\n           So I need to know the tournament.\n           Better approach: List tournaments first in this view or fetch all upcoming?\n           Let's fetch tournaments and then upcoming matches for the first active one for simplicity of this demo request.\n      -->\n      <div *ngIf=\"loading\" class=\"text-center text-white text-xl animate-pulse py-10\">Cargando...</div>\n      \n      <div *ngFor=\"let group of matchesByTorneo | keyvalue\" class=\"mb-8\">\n        <h2 class=\"text-2xl font-bold text-white mb-4 border-b border-white/30 pb-2 drop-shadow-md\">{{ group.key }}</h2>\n        <div class=\"grid gap-4 md:grid-cols-2\">\n             <div *ngFor=\"let match of group.value\" class=\"bg-white/95 backdrop-blur rounded-lg shadow-lg p-4 border-l-4 border-emerald-500 flex flex-col sm:flex-row justify-between items-center hover:scale-[1.02] transition-transform duration-200\">\n                <div class=\"text-sm text-gray-500 mb-2 sm:mb-0 w-32 font-mono bg-gray-100 rounded p-1 text-center border border-gray-200\">\n                    {{ match.fecha }} <br> <span class=\"text-emerald-700 font-bold\">{{ match.hora }}</span>\n                </div>\n                <div class=\"flex-1 flex justify-center items-center space-x-3 font-medium text-gray-900 mx-4\">\n                    <span class=\"w-1/3 text-right font-bold text-lg\">{{ match.equipoLocal }}</span>\n                    <span class=\"text-xs text-gray-400 bg-gray-200 rounded-full px-2 py-1\">VS</span>\n                    <span class=\"w-1/3 text-left font-bold text-lg\">{{ match.equipoVisitante }}</span>\n                </div>\n                <div class=\"text-sm text-emerald-600 font-bold w-32 text-right uppercase tracking-wider\">{{ match.canchaNombre }}</div>\n             </div>\n        </div>\n      </div>\n      \n      <div *ngIf=\"!loading && (matchesByTorneo | keyvalue)?.length === 0\" class=\"text-center text-white/70 py-10 text-xl bg-black/20 rounded-xl backdrop-blur-sm\">\n        No hay partidos programados próximamente.\n      </div>\n    </app-soccer-field-wrapper>\n  `\n})\nexport class UpcomingMatchesComponent {\n    api = inject(ApiService);\n    cdr = inject(ChangeDetectorRef);\n    matchesByTorneo: { [key: string]: any[] } = {};\n    loading = true;\n\n    ngOnInit() {\n        // Fetch valid tournaments first\n        this.api.get<any[]>('public/torneos').subscribe({\n            next: (torneos) => {\n                if (torneos.length === 0) {\n                    this.loading = false;\n                    this.cdr.detectChanges();\n                    return;\n                }\n\n                // Fetch matches for each tournament\n                // A bit inefficient but works for MVP without specific \"all matches\" endpoint\n                let loadedCount = 0;\n                torneos.forEach(t => {\n                    this.api.get<any[]>(`public/torneos/${t.id}/partidos/proximos`).subscribe({\n                        next: (matches) => {\n                            if (matches && matches.length > 0) {\n                                this.matchesByTorneo[t.nombre] = matches;\n                            }\n                            loadedCount++;\n                            if (loadedCount === torneos.length) {\n                                this.loading = false;\n                            }\n                            this.cdr.detectChanges();\n                        },\n                        error: () => {\n                            loadedCount++;\n                            if (loadedCount === torneos.length) {\n                                this.loading = false;\n                            }\n                            this.cdr.detectChanges();\n                        }\n                    });\n                });\n            },\n            error: () => {\n                this.loading = false;\n                this.cdr.detectChanges();\n            }\n        });\n    }\n}\n"
        }
    ]
}